# Hypervisor
А - пример Xen, B - пример KVM
![image](https://github.com/user-attachments/assets/21f01258-b3fd-499e-8935-47cf78b41482)

Обе конфигурации могут предусматривать запуск прокси-сервера ввода/вывода
(например, программного обеспечения QEMU) в домене 0 (Xen) или в ОС хоста
(KVM) для обслуживания гостевого ввода/вывода. Это решение увеличивает
оверхед на ввод/вывод, но с годами оно было оптимизировано за счет добавления
транспортов с разделяемой памятью и других технологий.

QEMU - прокси сервер нужный для проброса устройств. <br>
AWS выпустила гипервизор Nitro с компонентами на основе KVM
и аппаратной поддержкой всех основных ресурсов: процессоров, сетевых карт,
хранилищ, прерываний и таймеров. Прокси-сервер QEMU не используется.

HVM - аппаратная виртуализация, Hardware VM. <br>
PV, Paravirtualization - позволяет уведомить гостевую ось что она выполняется в режиме ВМ, что позволяет ей делать специальные гипервызовы, повышающие эффективность работы. <br>
Аппаратная поддержка устройств - в аппаратные устройства добавили поддержку виртуальных машин, сюда входит SR-IOV для сетевых устройств и устройств хранения. <br>
PVHVM - используется аппаратная виртуализация с поддержкой паравиртуализации.

## Типы целевых гипервизоров, которые можно трассировать
 - PV: гипервызовы (мультивызовы), обратные вызовы гипервизора, вызовы
драйверов, недополученное время;
 - PVHVM: обратные вызовы гипервизора, вызовы драйверов, недополученное
время;
 - PVHVM + драйверы SR-IOV: обратные вызовы гипервизора, недополученное
время;
 - KVM (Nitro): недополученное время.
## Возможные стратегии
### На уровне гостевой системы:

1. Инструментируйте гипервызовы (если они есть) для проверки выполнения
избыточных операций.
2. Проверьте недополученное процессорное время.
3. Используйте инструменты из предыдущих глав для анализа потребления ре-
сурсов, но не забывайте, что это виртуальные ресурсы. Их производительность
может ограничиваться гипервизором или внешним оборудованием и страдать
от конфликтов с другими гостевыми системами.

### На уровне хоста:

1. Инструментируйте выходы из виртуальной машины для проверки выполнения
избыточных операций.
2. Если используется прокси-сервер ввода/вывода (QEMU), измерьте его рабочую
нагрузку и задержку.
3. Примените инструменты из предыдущих глав для анализа потребления ре-
сурсов.
